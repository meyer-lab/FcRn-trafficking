pipeline {
  agent any
  stages {
    stage('Clean') {
      steps { sh 'git clean -ffdx' }
    }
    stage('Test') {
      steps {
        sh 'Rscript --default-packages=methods -e \"devtools::test(\'./fcrn\')\"'
      }
    }
    stage('Build') {
      steps {
        sh 'R CMD INSTALL --no-multiarch --with-keep.source fcrn'
        sh 'R -e \"library(fcrn); fcrn::full_plot()\"'
      }
    }
    stage('Report') {
      steps {
        archiveArtifacts artifacts: 'Output.pdf', onlyIfSuccessful: true
      }
    }
  }
}
